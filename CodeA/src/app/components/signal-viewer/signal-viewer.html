<div class="container">
  
  <!-- STEP 1: Choose Signal Type -->
  @if (step === 1) {
  <div class="step-container">
    <h2 class="main-title">Select Signal Type</h2>
    <p class="subtitle">Choose the type of signal you want to analyze</p>
    
    <div class="signal-type-grid">
      <div class="signal-type-card" (click)="selectSignalType('ecg')">
        <div class="card-icon">‚ù§Ô∏è</div>
        <h3>ECG Analysis</h3>
        <p>Electrocardiogram Signals</p>
      </div>
      
      <div class="signal-type-card" (click)="selectSignalType('eeg')">
        <div class="card-icon">üß†</div>
        <h3>EEG Signals</h3>
        <p>Electroencephalogram Data</p>
      </div>
    </div>
  </div>
  }

  <!-- STEP 2: Choose Channel Mode -->
  @if (step === 2) {
  <div class="step-container">
    <button class="back-btn" (click)="goBack()">‚Üê Back</button>
    
    <h2 class="main-title">Select Channel Mode</h2>
    <p class="subtitle">{{ signalType.toUpperCase() }} - Choose single or multi-channel display</p>
    
    <div class="channel-mode-grid">
      <div class="channel-mode-card" (click)="selectChannelMode('single')">
        <div class="mode-icon">üìä</div>
        <h3>Single Channel</h3>
        <p>Display one channel at a time</p>
      </div>
      
      <div class="channel-mode-card" (click)="selectChannelMode('multi')">
        <div class="mode-icon">üìà</div>
        <h3>Multi-Channel</h3>
        <p>Display multiple channels vertically stacked</p>
      </div>
    </div>
  </div>
  }

  <!-- STEP 3: Upload and View -->
  @if (step === 3) {
  <div>
    <button class="back-btn" (click)="goBack()">‚Üê Back</button>
    
    <div class="text-center mb-4">
      <h2 class="main-title">{{ signalType.toUpperCase() }} Signal Viewer</h2>
      <p class="subtitle">{{ channelMode === 'single' ? 'Single Channel' : 'Multi-Channel' }} Mode</p>
    </div>

    <!-- File Upload -->
    <div class="control-panel">
      <div class="mb-3">
        <label class="control-label">Upload Signal File:</label>
        <input 
          type="file" 
          class="form-control file-input" 
          (change)="onFileSelect($event)"
          accept=".json"
          id="fileInput">
        <small class="text-muted">Select a converted .json file</small>
      </div>
    </div>

    <!-- Controls - Only show AFTER file is loaded -->
    @if (channels.length > 0) {
    <div>
      <!-- Channel Selection -->
      <div class="channel-selection-panel">
        <h5 class="section-title">Select Channels to Display:</h5>
        
        <!-- Multi-Channel Mode: Checkboxes -->
        @if (channelMode === 'multi') {
        <div class="channel-grid">
          @for (channel of channels; track $index) {
          <label class="channel-checkbox-card">
            <input 
              type="checkbox" 
              class="channelBox" 
              [checked]="selectedChannels[$index]"
              (change)="onChannelToggle($index)">
            <span class="channel-name">{{ channel }}</span>
          </label>
          }
        </div>
        }
        
        <!-- Single Channel Mode: Dropdown -->
        @if (channelMode === 'single') {
        <div class="single-channel-selector text-center">
          <select 
            class="form-select channel-select" 
            (change)="onSingleChannelChange($event)">
            <option value="" disabled selected>-- Select a Channel --</option>
            @for (channel of channels; track $index) {
            <option [value]="$index">{{ channel }}</option>
            }
          </select>
        </div>
        }
      </div>

      <!-- Playback Controls - Only show when channels are selected -->
      @if (hasSelectedChannels()) {
      <div class="playback-controls">
        <!-- Pause/Resume Buttons -->
        <div class="button-container">
          <button 
            class="btn btn-danger circle-btn" 
            (click)="pause()"
            [disabled]="isPaused"
            title="Pause">
            ‚è∏
          </button>
          <button 
            class="btn btn-success circle-btn" 
            (click)="resume()"
            [disabled]="!isPaused"
            title="Resume">
            ‚ñ∂
          </button>
        </div>

        <!-- Time Window Control -->
        <div class="time-control">
          <label class="control-label">Time Window:</label>
          <div class="slider-container">
            <input 
              type="range" 
              class="time-slider" 
              [min]="1" 
              [max]="getMaxTimeWindow()" 
              [step]="0.1" 
              [value]="timeWindowSeconds"
              (input)="onTimeWindowChange($event)"
              id="timeScale">
            <span class="time-value">{{ timeWindowSeconds.toFixed(1) }}s</span>
          </div>
        </div>
      </div>
      }
    </div>
    }

    <!-- Signal Graph -->
    <div class="graph-container">
      @if (channels.length === 0) {
      <div class="empty-state">
        <p>üìÅ No signal loaded</p>
        <p class="text-muted">Upload a JSON file to begin</p>
      </div>
      }
      
      @if (channels.length > 0 && !hasSelectedChannels()) {
      <div class="empty-state">
        <p>üìä Signal loaded!</p>
        <p class="text-muted">Select channels above to display them</p>
      </div>
      }
      
      <div id="signal-graph" class="signal-graph"></div>
    </div>
  </div>
  }

</div>